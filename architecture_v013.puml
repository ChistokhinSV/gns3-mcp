@startuml GNS3 MCP Architecture v0.13

!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName Arial
skinparam defaultFontSize 12

title GNS3 MCP Server Architecture v0.13\n(Proposed Design)

' Define components
package "MCP Server v0.13" {

  ' Resources
  package "Resources (15+ URIs)" #E8F4F8 {
    component [gns3://projects/] as projects_list
    component [gns3://projects/{id}/nodes/] as nodes_list
    component [gns3://projects/{id}/links/] as links_list
    component [gns3://templates/] as templates_list
    component [gns3://sessions/console/] as console_sessions
    component [gns3://sessions/ssh/{node}/history] as ssh_history
    note right of projects_list
      **Read-only state**
      Browsable hierarchy
      Supports subscriptions (future)
    end note
  }

  ' Resource Templates
  package "Resource Templates (3+)" #F4E8F8 {
    component [gns3://templates/{id}/create] as node_template
    component [gns3://drawings/create/{type}] as drawing_template
    component [gns3://projects/{id}/export] as export_template
    note right of node_template
      **Declarative creation**
      Parameter validation
      Type-safe
    end note
  }

  ' Prompts
  package "Prompts (3+)" #F8F4E8 {
    component [setup_ssh] as ssh_prompt
    component [discover_topology] as topology_prompt
    component [troubleshoot_connectivity] as troubleshoot_prompt
    note right of ssh_prompt
      **Workflow guidance**
      Step-by-step instructions
      Device-specific
    end note
  }

  ' Tools
  package "Tools (10 Core)" #E8F8E8 {
    component [open_project] as open_proj
    component [set_node] as set_node
    component [console_send] as console_send
    component [console_read] as console_read
    component [ssh_configure] as ssh_config
    component [ssh_command] as ssh_cmd
    component [set_connection] as set_conn
    note right of open_proj
      **Actions only**
      State modifications
      Control operations
    end note
  }
}

' External systems
cloud "GNS3 Server" as gns3_server {
  component [GNS3 v3 API] as gns3_api
  component [Telnet Consoles] as telnet
}

cloud "SSH Proxy" as ssh_proxy {
  component [Netmiko SSH] as netmiko
  component [Session Manager] as ssh_sessions
}

actor "MCP Client\n(Claude Desktop/Code)" as client

' Relationships
client --> projects_list : Browse
client --> nodes_list : Browse
client --> ssh_history : Browse
client --> node_template : Create
client --> export_template : Create
client --> ssh_prompt : Guided workflow
client --> open_proj : Execute
client --> console_send : Execute
client --> ssh_cmd : Execute

projects_list --> gns3_api : GET /v3/projects
nodes_list --> gns3_api : GET /v3/projects/{id}/nodes
node_template --> gns3_api : POST /v3/projects/{id}/nodes
open_proj --> gns3_api : POST /v3/projects/{id}/open
set_node --> gns3_api : PUT /v3/projects/{id}/nodes/{node_id}
console_send --> telnet : telnetlib3
ssh_config --> netmiko : Configure session
ssh_cmd --> netmiko : Execute command
ssh_history --> ssh_sessions : Query history

' Notes
note bottom of client
  **User Experience Improvements**
  • 66% fewer tools (30 → 10)
  • Browse state via resources
  • Create via templates
  • Guided workflows via prompts
end note

note bottom of gns3_server
  **No Changes Required**
  GNS3 API v3 remains unchanged
end note

@enduml
